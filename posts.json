---
---
{% assign primary_content = site.posts | concat: site.events %}
[{%- for post in primary_content -%}
  {%- capture themes -%}[{%- for theme in post.themes -%}{%- assign theme_info = site.themes | where: 'relative_path', theme | first -%}"{{theme_info.short_title}}"{%- unless forloop.last -%},{%- endunless -%}{%- endfor -%}]{%- endcapture -%}
  {%- capture keywords -%}[{%- for tag in post.keywords -%}"{{tag}}"{%- unless forloop.last -%},{%- endunless -%}{%- endfor -%}]{%- endcapture -%}
  {%- capture post_html -%}{%- include post-block.html -%}{%- endcapture -%}
  {
    "objectID": "{{ post.title | slugify }}",
    "title": "{{ post.title | escape }}",
    "url": "{{ post.url }}",
    "content_type": "{{ post.content_type }}",
    "themes": {{themes}},
    "keywords": {{ keywords }},
    "date": "{{ post.date | date: site.date_format }}",
    "posted_at": "{{ post.date | date: '%s' }}",
    "excerpt": {{post.excerpt | jsonify | normalize_whitespace }},
    "post_html": {{ post_html | jsonify | normalize_whitespace }}
  }{%- unless forloop.last -%},{%- endunless -%}
{%- endfor -%}]