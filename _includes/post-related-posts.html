<div class="post__related-posts">
  {% assign previous_posts = "" | split: ',' %}
  {% assign next_posts = "" | split: ',' %}
  {% for theme in page.themes %}
    {% assign posts = site[page.collection] %}
      {% for post in posts %}
        {% if post.themes contains theme %}
          {% if post.date > page.date %}
            {% assign next_posts = next_posts | push: post %}
          {% endif %}
          {% if post.date < page.date %}
            {% assign previous_posts = previous_posts | push: post %}
          {% endif %}
        {% endif %}
    {% endfor %}
  {% endfor %}


  {% if next_posts.size > 0 %}
    {% assign read_next = next_posts | sort: date | first %}
    {% assign section_title = site.data.language.next_article %}
  {% else if next_posts.size == 0 %}
    {% assign read_next = previous_posts | sort: date | reverse | slice: 1,1 | first %}
    {% assign section_title = site.data.language.previous_article %}
  {% endif %}

  {% include post-next-by-theme.html %}

  {% include post-related-by-tag.html %}

</div>
